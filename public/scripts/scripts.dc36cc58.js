"use strict";angular.module("staffHackerApp",["ngAnimate","ngCookies","ngMessages","ngResource","ui.router","ngSanitize","ngTouch"]).provider("UserHolder",function(){return{sanity:function(){console.log("UserHolderProvider is alive!")},$get:function(){return{getUser:function(){return this.user},setUser:function(a){this.user=a}}}}}).provider("Nav",function(){var a={home:{state:"home",label:"Home",active:!0,visible:!0},index:{state:"index",label:"Home",active:!1,visible:!1},signup:{state:"signup",label:"Sign Up",active:!1,visible:!0},signin:{state:"signin",label:"Sign In",active:!1,visible:!0},signout:{state:"signout",label:"Sign Out",active:!1,visible:!1},search:{state:"search",label:"Search",active:!1,visible:!1},toArray:function(){var a=[this.home,this.signin,this.signup,this.signout,this.search];return a},securedStates:function(){var a=[this.search.state];return a},signIn:function(){console.log("Nav signing in!"),this.signin.visible=!1,this.signup.visible=!1,this.search.visible=!0,this.signout.visible=!0},signOut:function(){console.log("Nav signing out!"),this.signin.visible=!0,this.signup.visible=!0,this.search.visible=!1,this.signout.visible=!1},recruiterResults:{state:"recruiter-results",label:"Recruiter Results",active:!1,visible:!1},recruiterRatings:{state:"recruiter-ratings",label:"Recruiter Ratings",active:!1,visible:!1}};return{navTabs:a,$get:function(){return a}}}).config(["$stateProvider","$urlRouterProvider","NavProvider","UserHolderProvider","$httpProvider",function(a,b,c,d,e){e.defaults.withCredentials=!0,d.sanity(),a.state(c.navTabs.index.state,{url:"/",templateUrl:"views/home.html",controller:"MainCtrl"}).state(c.navTabs.home.state,{url:"/home",templateUrl:"views/home.html",controller:"MainCtrl"}).state(c.navTabs.signup.state,{url:"/signup",templateUrl:"views/signup.html",controller:"AuthCtrl"}).state(c.navTabs.signin.state,{url:"/signin",templateUrl:"views/signin.html",controller:"AuthCtrl"}).state(c.navTabs.signout.state,{url:"/",templateUrl:"views/home.html",controller:"MainCtrl"}).state(c.navTabs.recruiterRatings.state,{url:"/recruiter-rating/:recruiterId",templateUrl:"views/recruiter-rating.html",controller:"RecruiterCtrl",onEnter:["$state","AuthService",function(a,b){b.findSessionUser().success(function(b){b||a.go("home")}).error(function(){a.go("home")})}]}).state(c.navTabs.search.state,{url:"/search",templateUrl:"views/search.html",controller:"SearchCtrl",onEnter:["$state","AuthService",function(a,b){b.findSessionUser().success(function(b){b||a.go("home")}).error(function(){a.go("home")})}]}),b.otherwise(c.navTabs.home.state)}]),angular.module("staffHackerApp").controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("staffHackerApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("staffHackerApp").controller("AuthCtrl",["$scope","$cookies","$state","AuthService","Nav",function(a,b,c,d,e){function f(){var b={user:{email:a.email,password:a.password}};console.log("Called logUserIn with "+JSON.stringify(b)),d.signin(b).success(function(b){a.currentUser=b,d.setUser(a.currentUser),e.signIn(),console.log("Nav => "+JSON.stringify(e.toArray())),c.go(e.search.state)}).error(function(){alert("Sigin ERROR")})}console.log("AuthCtrl is alive!"),a.signUserUp=function(){var b={user:{name:a.name,email:a.email,password:a.password,password_confirmation:a.passwordConfirmation}};console.log("Called signUserUp with "+JSON.stringify(b)),d.signUp(b).success(function(b){a.currentUser=b,d.setUser(a.currentUser),e.signIn(),console.log("Nav => "+JSON.stringify(e.toArray())),c.go(e.search.state)}).error(function(){alert("Sigup ERROR")})},a.logUserIn=f}]),angular.module("staffHackerApp").controller("NavCtrl",["$scope","$rootScope","$cookies","$state","AuthService","Nav",function(a,b,c,d,e,f){var g=e.findSessionUser();g.success(function(a){a?(console.log("Data received "+JSON.stringify(a)),f.signIn()):f.signOut()}).error(function(){f.signOut()}),a.signOut=function(){e.signout(),f.signOut()},a.navTabs=f.toArray(),a.getTabClass=function(a){return a.active?"active":""},a.active=function(a){return d.is(a)},a.$on("$stateChangeSuccess",function(){console.log("stateChange"),a.navTabs.forEach(function(b){b.active=a.active(b.state),b.active===!0&&b.state===f.signout.state&&(console.log("Resolved to tab.state => "+b.state),e.signout(),f.signOut())})}),b.$on("$stateChangeStart",function(a,b){_.includes(f.securedStates(),b)&&_.isNull(e.getUser())&&a.preventDefault()})}]),angular.module("staffHackerApp").controller("SearchCtrl",["$scope","$location","$stateParams","$state","RecruiterService","AuthService","Nav",function(a,b,c,d,e,f,g){console.log("SearchCtrl is alive!"),a.findRecruiters=function(){console.log("Called findRecruiter with "+JSON.stringify(a.recruiterName));var b=f.getUser();console.log("Called User with "+JSON.stringify(b));var c={search:{name:a.recruiterName,companyName:a.companyName,rate:a.rate}};e.findRecruiters(c,b).success(function(b){a.recruiters=b}).error(function(a){alert("findRecruiters ERROR"+a)})},a.getRecruiter=function(a){console.log("Called getRecruiter with "+JSON.stringify(a));var b=f.getUser();console.log("Called AuthService.getUser() got "+JSON.stringify(b)),d.go(g.recruiterRatings.state,{recruiterId:a})},a.recruiterResultsState=g.recruiterResults.state}]).directive("drawStarsJs",function(){return{restrict:"A",scope:{options:"="},compile:function(a){var b=function(a,b){var c=b||{};if(c){var d=c.average,e=c.radius,f=new createjs.Stage(a[0]);d=d||0;var g=Math.floor(d),h=d-g;console.log("diff "+h+" average "+d);for(var i=0;g>i;i++){var j=new createjs.Shape;j.graphics.setStrokeStyle(1).beginStroke("#000000").beginFill("#FBB62B").drawPolyStar(i*e*2+e,e,e,5,.5,-90),f.addChild(j)}if(h>0){var k=new createjs.Shape,l=4*e*(1-h);k.graphics.setStrokeStyle(1).beginStroke("#000000").beginLinearGradientFill(["#FFF","#FBB62B"],[.5,.5],0,0,0,l).drawPolyStar(g*e*2+e,e,e,5,.5,-90),f.addChild(k)}f.update()}};if("CANVAS"!==a[0].tagName)throw new Error("drawStars can only be set on a canvas element. "+a[0].tagName+" will not work.");return function(a,c){a.$watch("options",function(){b(c,a.options)},!0)}}}}),angular.module("staffHackerApp").controller("RecruiterCtrl",["$scope","$location","$stateParams","$state","RecruiterService","AuthService","Nav",function(a,b,c,d,e,f,g){a.recruiterId=c.recruiterId,a.recruiterCall=e.getRecruiter(a.recruiterId,f.getUser()).success(function(b){a.recruiter=b,console.log("Got recruiter "+JSON.stringify(a.recruiter)+" with id "+a.recruiter.id)}).error(function(a){alert("getRecruiter ERROR"+a)}),console.log("RecruiterCtrl is alive with recruiterId "+a.recruiterId),a.createRating=function(){console.log("Called createRating with "+JSON.stringify(a.recruiterName)+" with recruiter id "+a.recruiterId);var b=f.getUser();console.log("Called User with "+JSON.stringify(b));var c={rating:{comments:a.comments,rate:a.rate,recruiter_id:a.recruiterId,user_id:b.id}};e.createRating(c,b).success(function(b){a.recruiter=b,e.getRecruiter(a.recruiterId,f.getUser()).success(function(b){a.recruiter=b,console.log("Got recruiter "+JSON.stringify(a.recruiter)+" with id "+a.recruiter.id)}).error(function(a){alert("getRecruiter ERROR"+a)})}).error(function(a){alert("findRecruiters ERROR"+a)})},a.recruiterResultsState=g.recruiterResults.state}]),angular.module("staffHackerApp").service("AuthService",["$http","UserHolder",function(a,b){this.signUp=function(b){return a.post("/api/signup",b)},this.signin=function(b){return console.log("Called AuthService.signin with "+JSON.stringify(b)),a.post("/api/signin",b)},this.setUser=function(a){console.log("Setting user "+JSON.stringify(a)),b.setUser(a)},this.isAuthenticated=function(){return!!b.getUser()},this.getUser=function(){return b.getUser()},this.createHeaders=function(a){return{remember_token:a?a.remember_token:""}},this.findSessionUser=function(){return a.get("/api/sessions").success(function(a){b.setUser(a)}).error(function(){alert("ERROR getting current user!")})},this.signout=function(){console.log("Called AuthService.signout with "+JSON.stringify(b.getUser()));var c=this.createHeaders(b.getUser());console.log("In signout "+JSON.stringify(c));var d=a({url:"/api/signout",method:"POST",data:b.getUser(),headers:c});return b.setUser({}),d}}]),angular.module("staffHackerApp").service("RecruiterService",["$http","AuthService",function(a,b){this.findRecruiters=function(c,d){console.log("Called RecruiterService.findRecruiters with "+JSON.stringify(c));var e=b.createHeaders(d);return console.log("In find Recruiter "+JSON.stringify(e)),a({withCredentials:!0,url:"/api/searchRecruiters",method:"POST",data:c,headers:e})},this.getRecruiter=function(c,d){console.log("Called RecruiterService.getRecruiter with "+JSON.stringify(c));var e=b.createHeaders(d);return console.log("In get Recruiter "+JSON.stringify(e)),a({withCredentials:!0,url:"/api/recruiters/"+c,method:"GET",headers:e})},this.createRating=function(c,d){var e=b.createHeaders(d);return console.log("Called RecruiterService.createRating with "+JSON.stringify(c)+" and headers "+e),a({withCredentials:!0,url:"/api/ratings",method:"POST",data:c,headers:e})}}]);